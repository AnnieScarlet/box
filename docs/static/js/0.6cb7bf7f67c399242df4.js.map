{"version":3,"sources":["webpack:///./src/pages/Upload.vue","webpack:///./node_modules/babel-runtime/core-js/get-iterator.js","webpack:///./src/pages/Upload.vue?65ee","webpack:///./src/components/Uploader.vue?ccfe","webpack:///./node_modules/core-js/library/fn/get-iterator.js","webpack:///./node_modules/core-js/library/modules/core.get-iterator.js","webpack:///src/components/Uploader.vue","webpack:///src/pages/Upload.vue","webpack:///./src/components/Uploader.vue"],"names":["__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_lib_template_compiler_index_id_data_v_ec7d9e92_hasScoped_false_transformToRequire_video_src_poster_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_lib_selector_type_template_index_0_Upload_vue__","__webpack_require__","__vue_styles__","ssrContext","Component","normalizeComponent","__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_lib_selector_type_script_index_0_Upload_vue___default","a","__webpack_exports__","module","exports","default","__esModule","esExports","render","_vm","this","_h","$createElement","_c","_self","attrs","id","_v","_l","file","key","name","type","value","multiple","on","change","$event","handleFileSelect","dragover","handleDragOver","drop","staticRenderFns","submit","preventDefault","staticClass","url","thumb_url","width","height","updateRect","rect","thumb_rect","directives","rawName","expression","placeholder","domProps","input","target","composing","title","description","_e","anObject","get","getIterator","it","iterFn","TypeError","call","HTMLCanvasElement","prototype","toBlob","length","len","i","CanvasWrapper","y","HEIGHT","draw","offsetLeft","offsetTop","x","resolveRect","_getPoint","getPoint","e","_current_rect","min","max","_getPoint2","p","getRect","_this","reset","FileReader","img","Image","result","_resolveSize","THUMBNAIL_MAX_SIZE","IMAGE_MAX_SIZE","_img_data","_img_url","r","_this2","_resolveSize2","IMAGE_QUALITY","FormData","data","Uploader","_Uploader2","stopPropagation","_iteratorNormalCompletion","f","_step","__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_lib_template_compiler_index_id_data_v_51b279ac_hasScoped_false_transformToRequire_video_src_poster_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_lib_selector_type_template_index_0_Uploader_vue__","__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_lib_selector_type_script_index_0_Uploader_vue___default"],"mappings":"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","file":"static/js/0.6cb7bf7f67c399242df4.js","sourcesContent":["function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-ec7d9e92\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Upload.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Upload.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Upload.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-ec7d9e92\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Upload.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/Upload.vue\n// module id = 3/Wh\n// module chunks = 0","module.exports = { \"default\": require(\"core-js/library/fn/get-iterator\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/core-js/get-iterator.js\n// module id = BO1k\n// module chunks = 0","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"upload\"}},[_vm._v(\"\\n  Upload\\n  \"),_vm._l((_vm.files),function(file){return _c('Uploader',{key:file.name,attrs:{\"file\":file}})}),_vm._v(\" \"),_c('input',{attrs:{\"type\":\"file\",\"value\":\"Drop files here\",\"multiple\":\"\"},on:{\"change\":function($event){_vm.handleFileSelect($event)},\"dragover\":function($event){_vm.handleDragOver($event)},\"drop\":function($event){_vm.handleFileSelect($event)}}})],2)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-ec7d9e92\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/Upload.vue\n// module id = XUdU\n// module chunks = 0","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.thumb_url)?_c('form',{on:{\"submit\":function($event){$event.preventDefault();_vm.submit($event)}}},[_c('div',[_c('div',{staticClass:\"thumbnail\"},[_c('CanvasWrapper',{attrs:{\"url\":_vm.thumb_url,\"width\":_vm.width,\"height\":_vm.height,\"updateRect\":_vm.updateRect}}),_vm._v(\" \"),_c('Thumbnail',{attrs:{\"url\":_vm.thumb_url,\"rect\":_vm.thumb_rect}})],1)]),_vm._v(\" \"),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.title),expression:\"title\"}],attrs:{\"type\":\"text\",\"name\":\"title\",\"placeholder\":\"title\"},domProps:{\"value\":(_vm.title)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.title=$event.target.value}}})]),_vm._v(\" \"),_c('div',[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.description),expression:\"description\"}],attrs:{\"name\":\"description\",\"placeholder\":\"description\"},domProps:{\"value\":(_vm.description)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.description=$event.target.value}}})]),_vm._v(\" \"),_c('button',{attrs:{\"type\":\"submit\"}},[_vm._v(\"Submit\")])]):_vm._e()}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-51b279ac\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Uploader.vue\n// module id = dnkX\n// module chunks = 0","require('../modules/web.dom.iterable');\nrequire('../modules/es6.string.iterator');\nmodule.exports = require('../modules/core.get-iterator');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/fn/get-iterator.js\n// module id = fxRn\n// module chunks = 0","var anObject = require('./_an-object');\nvar get = require('./core.get-iterator-method');\nmodule.exports = require('./_core').getIterator = function (it) {\n  var iterFn = get(it);\n  if (typeof iterFn != 'function') throw TypeError(it + ' is not iterable!');\n  return anObject(iterFn.call(it));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/modules/core.get-iterator.js\n// module id = g8Ux\n// module chunks = 0","<template>\n  <form v-on:submit.prevent=\"submit\" v-if=\"thumb_url\">\n    <div>\n      <div class=\"thumbnail\">\n        <CanvasWrapper v-bind:url=\"thumb_url\" v-bind:width=\"width\" v-bind:height=\"height\" v-bind:updateRect=\"updateRect\" />\n        <Thumbnail v-bind:url=\"thumb_url\" v-bind:rect=\"thumb_rect\" />\n      </div>\n    </div>\n    <div>\n      <input type=\"text\" name=\"title\" v-model=\"title\" placeholder=\"title\" />\n    </div>\n    <div>\n      <textarea name=\"description\" v-model=\"description\" placeholder=\"description\"></textarea>\n    </div>\n    <button type=\"submit\">Submit</button>\n  </form>\n</template>\n\n<script>\nimport consts from '@/constants'\nimport api from '@/api'\nimport Thumbnail from '@/components/Thumbnail'\n\nif (!HTMLCanvasElement.prototype.toBlob) {\n  Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n    value: (callback, type, quality) => {\n      let binStr = atob(this.toDataURL(type, quality).split(',')[1])\n      let len = binStr.length\n      let arr = new Uint8Array(len)\n\n      for (var i = 0; i < len; i++) {\n        arr[i] = binStr.charCodeAt(i)\n      }\n\n      callback(new Blob([arr], {type: type || 'image/png'}))\n    }\n  })\n}\n\nconst CanvasWrapper = {\n  template: '<canvas v-bind:width=\"width\" v-bind:height=\"height\" v-bind:style=\"styleObject\" v-on:mousedown=\"onMouseDown($event)\" v-on:mouseup=\"onMouseUp($event)\" v-on:mousemove=\"onMouseMove($event)\"></canvas>',\n  props: ['url', 'width', 'height', 'updateRect'],\n  computed: {\n    styleObject () {\n      return {\n        backgroundImage: `url(${this.url})`,\n        backgroundSize: '100%'\n      }\n    }\n  },\n  mounted () {\n    this._ctx = this.$el.getContext('2d')\n    this._ctx.fillStyle = 'rgba(0, 0, 0, 0.4)'\n    this._ctx.strokeStyle = 'red'\n\n    // デフォルト矩形の起点\n    let pivot = {\n      x: parseInt((this.width - consts.THUMBNAIL_BOX_SIZE.WIDTH) / 2),\n      y: parseInt((this.height - consts.THUMBNAIL_BOX_SIZE.HEIGHT) / 2)\n    }\n\n    this._begin_point = {x: 0, y: 0}\n    this._current_rect = {\n      min: {x: pivot.x, y: pivot.y},\n      max: {x: pivot.x + consts.THUMBNAIL_BOX_SIZE.WIDTH, y: pivot.y + consts.THUMBNAIL_BOX_SIZE.HEIGHT}\n    }\n\n    this.draw()\n  },\n  methods: {\n    // 矩形の値を 0 ~ 1.0 の値にして返す\n    getRect () {\n      return {\n        min: {x: this._current_rect.min.x / this.width, y: this._current_rect.min.y / this.height},\n        max: {x: this._current_rect.max.x / this.width, y: this._current_rect.max.y / this.height}\n      }\n    },\n    // canvas の左上 を起点としたカーソル位置を返す\n    getPoint (e) {\n      return {\n        x: (window.pageXOffset + e.clientX) - this.$el.offsetLeft,\n        y: (window.pageYOffset + e.clientY) - this.$el.offsetTop\n      }\n    },\n    // canvas からはみ出た矩形の位置を解決する\n    resolveRect () {\n      if (this._current_rect.min.x < 0) {\n        this._current_rect.max.x -= this._current_rect.min.x\n        this._current_rect.min.x = 0\n      }\n      if (this._current_rect.min.y < 0) {\n        this._current_rect.max.y -= this._current_rect.min.y\n        this._current_rect.min.y = 0\n      }\n      if (this._current_rect.max.x > this.width) {\n        this._current_rect.min.x -= this._current_rect.max.x - this.width\n        this._current_rect.max.x = this.width\n      }\n      if (this._current_rect.max.y > this.height) {\n        this._current_rect.min.y -= this._current_rect.max.y - this.height\n        this._current_rect.max.y = this.height\n      }\n    },\n    // 矩形のスケールを変更\n    setScale (scale) {\n      if (this.width * scale < consts.THUMBNAIL_BOX_SIZE.WIDTH) {\n        scale = consts.THUMBNAIL_BOX_SIZE.WIDTH / this.width\n      }\n      if (this.height * scale < consts.THUMBNAIL_BOX_SIZE.HEIGHT) {\n        scale = consts.THUMBNAIL_BOX_SIZE.HEIGHT / this.height\n      }\n      let size = {w: this._current_rect.max.x - this._current_rect.min.x, h: this._current_rect.max.y - this._current_rect.min.y}\n      let pivot = {x: this._current_rect.min.x + size.w / 2, y: this._current_rect.min.y + size.h / 2}\n      let x = consts.THUMBNAIL_BOX_SIZE.WIDTH * (1.0 / scale) / 2\n      let y = consts.THUMBNAIL_BOX_SIZE.HEIGHT * (1.0 / scale) / 2\n      this._current_rect = {\n        min: {x: pivot.x - x, y: pivot.y - y},\n        max: {x: pivot.x + x, y: pivot.y + y}\n      }\n      this.resolveRect()\n    },\n    onMouseDown (e) {\n      if (this._dragging) {\n        return\n      }\n\n      let { x, y } = this.getPoint(e)\n\n      if (this._current_rect.min.x <= x && x <= this._current_rect.max.x &&\n          this._current_rect.min.y <= y && y <= this._current_rect.max.y) {\n        this._dragging = true\n        this._begin_point = {x: x - this._current_rect.min.x, y: y - this._current_rect.min.y}\n      }\n    },\n    onMouseUp (e) {\n      this._dragging = false\n    },\n    onMouseMove (e) {\n      if (!this._dragging) {\n        return\n      }\n\n      let { x, y } = this.getPoint(e)\n\n      let p = {\n        x: x - this._begin_point.x,\n        y: y - this._begin_point.y\n      }\n      this._current_rect = {\n        min: p,\n        max: {\n          x: this._current_rect.max.x - (this._current_rect.min.x - p.x),\n          y: this._current_rect.max.y - (this._current_rect.min.y - p.y)\n        }\n      }\n\n      // canvas 外へは矩形を移動しない\n      if (this._current_rect.min.x < 0) {\n        this._begin_point.x = x\n      }\n      if (this._current_rect.max.x > this.width) {\n        this._begin_point.x = x - (this.width - (this._current_rect.max.x - this._current_rect.min.x))\n      }\n      if (this._current_rect.min.y < 0) {\n        this._begin_point.y = y\n      }\n      if (this._current_rect.max.y > this.height) {\n        this._begin_point.y = y - (this.height - (this._current_rect.max.y - this._current_rect.min.y))\n      }\n\n      this.resolveRect()\n      this.draw()\n    },\n    draw () {\n      this._ctx.clearRect(0, 0, this.width, this.height)\n      this._ctx.fillRect(0, 0, this.width, this.height)\n      this._ctx.clearRect(this._current_rect.min.x, this._current_rect.min.y, this._current_rect.max.x - this._current_rect.min.x, this._current_rect.max.y - this._current_rect.min.y)\n      this._ctx.strokeRect(this._current_rect.min.x, this._current_rect.min.y, this._current_rect.max.x - this._current_rect.min.x, this._current_rect.max.y - this._current_rect.min.y)\n      this.updateRect(this.getRect())\n    }\n  }\n}\n\nexport default {\n  components: { Thumbnail, CanvasWrapper },\n  props: ['file'],\n  data () {\n    return {\n      width: 0,\n      height: 0,\n      thumb_url: null,\n      thumb_rect: null,\n      title: null,\n      description: null\n    }\n  },\n  mounted () {\n    this.reset()\n\n    let vm = this\n    let reader = new FileReader()\n    reader.readAsDataURL(this.file)\n    reader.onload = async () => {\n      let img = new Image()\n      img.src = reader.result\n      img.onload = async () => {\n        let { width, height } = this.resolveSize(img.width, img.height, consts.THUMBNAIL_MAX_SIZE, consts.THUMBNAIL_MAX_SIZE)\n\n        vm.width = width\n        vm.height = height\n\n        vm._img_data = await this.resize(img, consts.IMAGE_MAX_SIZE)\n        vm._img_url = URL.createObjectURL(vm._img_data)\n        vm.thumb_url = vm._img_url\n      }\n    }\n  },\n  methods: {\n    updateRect (rect) {\n      this.thumb_rect = rect\n    },\n    reset () {\n      this._img_data = null\n      if (this._img_url) {\n        URL.revokeObjectURL(this._img_url)\n      }\n    },\n    resolveSize (width, height, max, min) {\n      let calc = (exp, ratio) => {\n        let r = ratio(exp(width, height))\n        width *= r\n        height *= r\n      }\n      if (max) {\n        calc(Math.max, (x) => x > max ? max / x : 1)\n      }\n      if (min) {\n        calc(Math.min, (x) => x < min ? min / x : 1)\n      }\n      return { width, height }\n    },\n    async resize (src, max, tmp) {\n      let { width, height } = this.resolveSize(src.width, src.height, max)\n      tmp = tmp || document.createElement('canvas')\n      let ctx = tmp.getContext('2d')\n\n      // 急激に縮小するとかなりギザる\n      // if (width / src.width <= 0.5) {\n      //   tmp.width = src.width * 0.5\n      //   tmp.height = src.height * 0.5\n      //   ctx.drawImage(src, 0, 0, tmp.width, tmp.height)\n      //   return await this.resize(tmp, max, src.getContext && src)\n      // }\n\n      tmp.width = width\n      tmp.height = height\n      ctx.drawImage(src, 0, 0, width, height)\n\n      return new Promise((resolve, reject) => {\n        tmp.toBlob(resolve, 'image/jpeg', consts.IMAGE_QUALITY)\n      })\n    },\n    submit (e) {\n      let data = new FormData()\n      data.append('title', this.title)\n      data.append('description', this.description)\n      data.append('file', this._img_data)\n      api.postMediaData(data)\n    }\n  },\n  destroyed () {\n    this.reset()\n  }\n}\n</script>\n\n<style>\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Uploader.vue","<template>\n  <div id=\"upload\">\n    Upload\n    <Uploader v-for=\"file in files\" v-bind:file=\"file\" v-bind:key=\"file.name\" />\n    <input type=\"file\" value=\"Drop files here\" multiple\n            v-on:change=\"handleFileSelect($event)\"\n            v-on:dragover=\"handleDragOver($event)\"\n            v-on:drop=\"handleFileSelect($event)\" />\n  </div>\n</template>\n\n<script>\nimport Uploader from '@/components/Uploader'\n\nexport default {\n  components: { Uploader },\n  data () {\n    return {\n      files: []\n    }\n  },\n  methods: {\n    handleFileSelect (e) {\n      e.stopPropagation()\n      e.preventDefault()\n\n      for (let f of (e.dataTransfer || e.target).files) {\n        if (f.type.indexOf('image/') === 0) {\n          this.files.push(f)\n        }\n      }\n    },\n    handleDragOver (e) {\n      e.stopPropagation()\n      e.preventDefault()\n      e.dataTransfer.dropEffect = 'copy'  // Explicitly show this is a copy.\n    }\n  }\n}\n</script>\n\n<style>\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/pages/Upload.vue","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-51b279ac\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Uploader.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Uploader.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Uploader.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-51b279ac\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Uploader.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Uploader.vue\n// module id = uHkJ\n// module chunks = 0"],"sourceRoot":""}